<!DOCTYPE html>
<html lang="uz">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bugungi taomlar</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        background-color: #f8f9fa;
      }
    </style>
  </head>
  <body>
    <div class="container py-2">
      <!-- <h2 class="text-center mb-2 fw-bold text-primary display-5">
        Bugungi taomlar
      </h2> -->

      <div id="food-list" class="row justify-content-center g-5">
        <div class="text-center text-muted fs-4">Yuklanmoqda...</div>
      </div>
    </div>

    <script>
      const BASE_URL = "http://84.54.118.39:3007";
      const REFRESH_INTERVAL = 30000; // 30 soniya
      const screenId = 1; // üëà televizor raqami

      async function loadFoods() {
        const foodList = document.getElementById("food-list");
        foodList.innerHTML = `<div class="text-center text-muted fs-4">Yuklanmoqda...</div>`;

        try {
          const today = new Date().toISOString().split("T")[0];
          const res = await fetch(`${BASE_URL}/foods/${today}`);
          if (!res.ok) throw new Error("Serverdan ma'lumot olinmadi");

          const parsedData = await res.json();
          const foods = parsedData.map((item) => item.food);

          if (foods.length === 0) {
            foodList.innerHTML = `
              <div class="text-center text-danger fs-4">
                Hali taom tanlanmagan
              </div>`;
            return;
          }

          // Ma‚Äôlumotni ikkiga bo‚Äòlish
          const mid = Math.ceil(foods.length / 2);
          const firstHalf = foods.slice(0, mid);
          const secondHalf = foods.slice(mid);
          const visibleFoods = screenId === 1 ? firstHalf : secondHalf;

          foodList.innerHTML = visibleFoods
            .map((food) => {
              const imageUrl = food.image?.startsWith("http")
                ? food.image
                : `${BASE_URL}/uploads/foods/${food.image}`;

              return `
                <div class="col-12 col-sm-8 col-md-6 col-lg-4 d-flex justify-content-center">
                  <div class="card shadow-lg rounded-4 border-0" style="width: 100%; max-width: 420px;">
                    <img
                      src="${imageUrl}"
                      alt="${food.name}"
                      class="card-img-top"
                      style="height: 280px; object-fit: cover; border-top-left-radius: 1.5rem; border-top-right-radius: 1.5rem;"
                    />
                    <div class="card-body p-4">
                      <div class="d-flex justify-content-between align-items-center mb-2">
                        <h4 class="card-title mb-0 fw-semibold text-dark">${
                          food.name
                        }</h4>
                        <span class="text-success fw-bold fs-5">${food.price?.toLocaleString()} so‚Äòm</span>
                      </div>
                      ${
                        food.description
                          ? `<p class="card-text mt-1 text-muted fs-6">${food.description}</p>`
                          : ""
                      }
                    </div>
                  </div>
                </div>
              `;
            })
            .join("");
        } catch (error) {
          console.error("‚ùå Ma'lumot olishda xatolik:", error);
          foodList.innerHTML = `
            <div class="text-center text-danger fs-4">
              Server bilan aloqa uzildi
            </div>`;
        }
      }

      // Dastlab yuklash va har 30 soniyada yangilash
      loadFoods();
      setInterval(loadFoods, REFRESH_INTERVAL);
    </script>
  </body>
</html>
